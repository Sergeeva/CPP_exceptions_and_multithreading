# –ß–∞—Å—Ç—å 2: –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–º–∏—Ç–∏–≤—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ –°++

## üéØ –¶–µ–ª–∏ —á–∞—Å—Ç–∏ 2
- **–û—Å–≤–æ–∏—Ç—å –æ—Å–Ω–æ–≤—ã —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Ç–æ–∫–∞–º–∏ –≤ –°++** 
- **–û—Å–≤–æ–∏—Ç—å –ø—Ä–∏–º–∏—Ç–∏–≤—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏** –æ—Ç –±–∞–∑–æ–≤—ã—Ö –¥–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö
- **–ü–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø–æ—Ç–æ–∫–∞–º–∏**
- **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç pthread –∫ std::thread** —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
### –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ "pthread ‚Üí std::thread":
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–Ω–∞–∫–æ–º—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –≤ –Ω–æ–≤–æ–π –æ–±—ë—Ä—Ç–∫–µ
- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ type safety –∏ RAII
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ—Ä—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
- –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏

---

## üìã**2.1 –ü–æ—Ç–æ–∫–∏: –æ—Ç pthread –∫ std::thread**

**–ü–æ—Ç–æ–∫ (thread)**¬†‚Äì –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –ø—É—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞, –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã (–û–°). –í—Å–µ –ø–æ—Ç–æ–∫–∏ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–∑–¥–µ–ª—è—é—Ç –ø–∞–º—è—Ç—å –∏ —Ä–µ—Å—É—Ä—Å—ã, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –µ—Å—Ç—å —Ä–∏—Å–∫ **–≥–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö**.

**–ö–ª—é—á–µ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- **–û–±—â–µ–µ –∞–¥—Ä–µ—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ** - –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–∏–¥—è—Ç –æ–¥–Ω—É –ø–∞–º—è—Ç—å
- **–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ç–µ–∫** - –∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –∏–º–µ–µ—Ç —Å–≤–æ–π —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤
- **–û–±—â–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** - –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** - –û–° —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø–æ—Ç–æ–∫–æ–≤
##### **–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –≤ –°-—Å—Ç–∏–ª–µ: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è pthread API**
```c
// –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π pthread –∫–æ–¥
#include <pthread.h>

struct ThreadData {
    int start;
    int end;
    double* result;
};

void* worker_thread(void* arg) {
    ThreadData* data = (ThreadData*)arg;  // –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤
    
    // –†–∞–±–æ—Ç–∞...
    data->result = calculate(data->start, data->end);
    
    return NULL;  // –ü–æ—Ç–µ—Ä—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
}

int main() {
    pthread_t threads[4];
    ThreadData thread_data[4];
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤
    for (int i = 0; i < 4; i++) {
        thread_data[i] = {i * 1000, (i + 1) * 1000, nullptr};
        pthread_create(&threads[i], NULL, worker_thread, &thread_data[i]);
    }
    
    // –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    for (int i = 0; i < 4; i++) {
        pthread_join(threads[i], NULL);
    }
}
```

**–ü—Ä–æ–±–ª–µ–º—ã pthread:**
- **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤:** `void*` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é:** –Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π:** —Ç–æ–ª—å–∫–æ –∫–æ–¥—ã –æ—à–∏–±–æ–∫
- **–ü–ª–∞—Ç—Ñ–æ—Ä–º–æ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**

#### **–ü–æ—Ç–æ–∫–∏ –≤ –°++**
**std::thread**¬†‚Äì –±–∞–∑–æ–≤—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –≤ C++ (—Å –≤–µ—Ä—Å–∏–∏ C++11). –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏, –∫–ª–∞—Å—Å—ã, –ª—è–º–±–¥–∞-–≤—ã—Ä–∞–∂–µ–Ω–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö.

##### **–û—Å–Ω–æ–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Ç–æ–∫–∞**
```cpp
#include <thread>
#include <iostream>

// 1. –û–±—ã—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
void hello() {
    std::cout << "Hello from thread!" << std::endl;
}

// 2. –§—É–Ω–∫—Ü–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
void print_number(int n) {
    std::cout << "Number: " << n << std::endl;
}

// 3. –ö–ª–∞—Å—Å —Å operator()
class Callable {
public:
    void operator()() {
        std::cout << "Called from class!" << std::endl;
    }
};

int main() {
    // –°–ø–æ—Å–æ–±—ã —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤
    std::thread t1(hello);                          // —Ñ—É–Ω–∫—Ü–∏—è
    std::thread t2(print_number, 42);              // —Ñ—É–Ω–∫—Ü–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
    std::thread t3(Callable{});                    // —Ñ—É–Ω–∫—Ç–æ—Ä
    std::thread t4([]{                              // –ª—è–º–±–¥–∞
        std::cout << "Lambda thread!" << std::endl;
    });
    
    // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º –∏–ª–∏ –æ—Ç—Å–æ–µ–¥–∏–Ω—è–µ–º
    t1.join();
    t2.join();
    t3.join();
    t4.join();
    
    return 0;
}
```

##### **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º:**
```cpp
std::thread t(worker_function);

// –í–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
if (t.joinable()) {
    t.join();    // –ñ–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞
    // –∏–ª–∏
    t.detach();  // –û—Ç—Å–æ–µ–¥–∏–Ω–∏—Ç—å –ø–æ—Ç–æ–∫ (daemon thread)
}

// –û–®–ò–ë–ö–ê: –∑–∞–±—ã—Ç—å join() –∏–ª–∏ detach() ‚Üí std::terminate
```

##### **‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ std::thread**
- **Type safety:** –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∏–ø—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **RAII:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏
- **Exception safety:** –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è
- **–ü–æ—Ä—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å:** –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö

##### **‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã std::thread:**
1. **–ó–∞–±—ã—Ç—ã–π join()** - –≤—ã–∑—ã–≤–∞–µ—Ç std::terminate
2. **–ü–µ—Ä–µ–¥–∞—á–∞ —Å—Å—ã–ª–æ–∫** - —Ç—Ä–µ–±—É–µ—Ç std::ref()
3. **–ò—Å–∫–ª—é—á–µ–Ω–∏—è** - –º–æ–≥—É—Ç –ø—Ä–µ—Ä–≤–∞—Ç—å join()

#### std::jthread (C++20) - –£–ª—É—á—à–µ–Ω–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞

**std::jthread** (joining thread) ‚Äì —É—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è std::thread, —Ä–µ—à–∞—é—â–∞—è –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —É–¥–æ–±—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

**‚úÖ–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
##### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (Auto-joining)**
```cpp
void safe_example() {
    std::jthread jt([]{ 
        std::this_thread::sleep_for(std::chrono::seconds(2));
        std::cout << "Task completed" << std::endl;
    });
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è join() –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
    // –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º —Å –∑–∞–±—ã—Ç—ã–º join()!
}
```

##### 2. **–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç–º–µ–Ω—ã —á–µ—Ä–µ–∑ std::stop_token**
```cpp
#include <thread>
#include <stop_token>

void cancellable_task(std::stop_token stoken) {
    int counter = 0;
    while (!stoken.stop_requested()) {
        std::cout << "Working... " << ++counter << std::endl;
        std::this_thread::sleep_for(std::chrono::milliseconds(500));
        
        if (counter > 10) break;  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ –≤—ã—Ö–æ–¥–∞
    }
    std::cout << "Task finished gracefully" << std::endl;
}

void example_with_cancellation() {
    std::jthread jt(cancellable_task);
    
    // –î–∞–µ–º –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å 2 —Å–µ–∫—É–Ω–¥—ã
    std::this_thread::sleep_for(std::chrono::seconds(2));
    
    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –æ—Å—Ç–∞–Ω–æ–≤–∫—É
    jt.request_stop();
    
    // jt –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—Å—è –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
}
```

##### 3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è RAII —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
```cpp
class BackgroundWorker {
    std::jthread worker_;
    
public:
    BackgroundWorker() : worker_(&BackgroundWorker::work, this) {}
    
    void stop() {
        worker_.request_stop();
    }
    
    // –î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–º
    ~BackgroundWorker() = default;
    
private:
    void work(std::stop_token token) {
        while (!token.stop_requested()) {
            // –í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞–±–æ—Ç—É...
            std::this_thread::sleep_for(std::chrono::milliseconds(100));
        }
    }
};
```

#### **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ std::thread vs std::jthread:**

| **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞**               | **std::thread**                       | **std::jthread**                 |
| -------------------------------- | ------------------------------------- | -------------------------------- |
| **–°—Ç–∞–Ω–¥–∞—Ä—Ç C++**                 | C++11                                 | C++20                            |
| **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** | ‚ùå –¢—Ä–µ–±—É–µ—Ç —è–≤–Ω—ã–π join()/detach()       | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ    |
| **–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–±—ã—Ç–æ–º join()** | üí• std::terminate                     | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ          |
| **–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –æ—Ç–º–µ–Ω–∞**            | ‚ùå –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–ª–∞–≥–∏ | ‚úÖ std::stop_token                |
| **RAII —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**           | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏               | ‚úÖ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è        |
| **–†–∞–∑–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞**               | ~8 –±–∞–π—Ç                               | ~16 –±–∞–π—Ç                         |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**           | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã         | –ù–µ–±–æ–ª—å—à–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã |

---

## üìã**2.2: –ü—Ä–∏–º–∏—Ç–∏–≤—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ –°++**

**–ì–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö (Data Race)** ‚Äì —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –¥–≤–∞ –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ—Ç–æ–∫–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (—Ä–∞–∑–¥–µ–ª—è–µ–º–æ–º—É —Ä–µ—Å—É—Ä—Å—É), –∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∑–∞–ø–∏—Å—å.

**–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç: —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∞—Å—Å–µ–º–±–ª–µ—Ä–Ω–æ–º —É—Ä–æ–≤–Ω–µ**
```
++global_counter —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ:
1. mov eax, [global_counter]  ; –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
2. inc eax                    ; —É–≤–µ–ª–∏—á–∏—Ç—å
3. mov [global_counter], eax  ; —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å

–ü–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ—Ä–≤–∞–Ω –º–µ–∂–¥—É –ª—é–±—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏!
```

**–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** -- –Ω–µ–¥–µ–ª–∏–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏. –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–æ–≤—Å–µ–º, —á–∞—Å—Ç–∏—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.

**std::atomic** ‚Äì —à–∞–±–ª–æ–Ω –∫–ª–∞—Å—Å–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –±–∞–∑–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.
**–û—Å–Ω–æ–≤–Ω—ã–µ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –°++:**
```cpp
std::atomic<int> atomic_int{0};

// –ó–∞–≥—Ä—É–∑–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è
int value = atomic_int.load();

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
atomic_int.store(42);

// –û–±–º–µ–Ω –∑–Ω–∞—á–µ–Ω–∏—è
int old_value = atomic_int.exchange(new_value);

// Compare-and-swap
int expected = 10;
bool success = atomic_int.compare_exchange_weak(expected, 20);

// –ê—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
atomic_int.fetch_add(5);      // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
atomic_int.fetch_sub(3);
atomic_int += 2;              // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
++atomic_int;
```
–ù–∞ –º–æ–¥–µ–ª—è—Ö –ø–∞–º—è—Ç–∏ –º—ã –Ω–µ –±—É–¥–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è.

**–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (Thread Safety)**
–°–≤–æ–π—Å—Ç–≤–æ –∫–æ–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ –±–µ–∑ –≥–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.
**–£—Ä–æ–≤–Ω–∏ thread safety:**
1. **Thread-unsafe** - —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
2. **Thread-compatible** - –±–µ–∑–æ–ø–∞—Å–µ–Ω –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏, —Ç—Ä–µ–±—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏
3. **Thread-safe** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–∫—Ü–∏—è (Critical Section)**
–£—á–∞—Å—Ç–æ–∫ –∫–æ–¥–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ —Ä–∞–∑–¥–µ–ª—è–µ–º—ã–º —Ä–µ—Å—É—Ä—Å–∞–º –∏ –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¥—Ä—É–≥–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ (—Ç.–µ. –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–µ–∫—Ü–∏–∏ –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫).

### **–í–∑–∞–∏–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ (mutual exclusion)**
**–ú—å—é—Ç–µ–∫—Å**¬†‚Äì–ø—Ä–∏–º–∏—Ç–∏–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –æ–±–µ—Å–ø–µ—á–∏—Ç—å —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É. –û–¥–∏–Ω –ø–æ—Ç–æ–∫ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –º—å—é—Ç–µ–∫—Å, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∂–¥—É—Ç. –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–µ–∫—Ü–∏–∏ (–º–µ–∂–¥—É lock –∏ unlock).
‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º—å—é—Ç–µ–∫—Å–∞ –≤–µ–¥–µ—Ç –∫ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏. –ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –º—å—é—Ç–µ–∫—Å–∞ -- **–æ—á–µ—Ä–µ–¥—å**.
#####  **–û—Ç pthread_mutex –∫ std::mutex**
```c
// pthread –ø–æ–¥—Ö–æ–¥
pthread_mutex_t mtx = PTHREAD_MUTEX_INITIALIZER;
int shared_resource = 0;

void* worker(void* arg) {
    pthread_mutex_lock(&mtx);
    shared_resource++;  // –ß—Ç–æ –µ—Å–ª–∏ –∑–¥–µ—Å—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ?
    pthread_mutex_unlock(&mtx);  // –ú–æ–∂–µ—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è!
    return NULL;
}
```

```cpp
// C++ –ø–æ–¥—Ö–æ–¥ —Å RAII
std::mutex mtx;
int shared_resource = 0;

void worker() {
    std::lock_guard<std::mutex> lock(mtx);  // RAII
    shared_resource++;  // –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ!
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π unlock –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
}
```


**std::mutex** ‚Äì –±–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–∏—Ç–∏–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –≤–∑–∞–∏–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ (mutual exclusion). –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –≤–ª–∞–¥–µ—Ç—å –º—å—é—Ç–µ–∫—Å–æ–º –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏.

**–¢–∏–ø—ã –º—å—é—Ç–µ–∫—Å–æ–≤:**
- **std::mutex** - –æ–±—ã—á–Ω—ã–π –º—å—é—Ç–µ–∫—Å
- **std::recursive_mutex** - –º–æ–∂–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∏–∑ –æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
- **std::timed_mutex** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ timeout –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
- **std::shared_mutex** - —Ä–∞–∑–¥–µ–ª—è–µ–º—ã–π –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –º—å—é—Ç–µ–∫—Å (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∏—Ç–∞—Ç–µ–ª–µ–π), read-write lock (C++17).  –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –ø–æ—Ç–æ–∫–∞–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –Ω–æ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è –∑–∞–ø–∏—Å–∏.

**RAII –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è –º—å—é—Ç–µ–∫—Å–æ–≤:** —Ö–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞
```cpp
std::mutex mtx;

// 1. std::lock_guard - –ø—Ä–æ—Å—Ç–∞—è RAII –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
{
    std::lock_guard<std::mutex> lock(mtx);
    // –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–∫—Ü–∏—è
    // –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
}

// 2. std::unique_lock - –≥–∏–±–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
{
    std::unique_lock<std::mutex> lock(mtx);
    // –º–æ–∂–Ω–æ unlock() –∏ lock() —Å–Ω–æ–≤–∞
    lock.unlock();
    // –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞
    lock.lock();
    // —Å–Ω–æ–≤–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–∫—Ü–∏—è
}

// 3. std::scoped_lock - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º—å—é—Ç–µ–∫—Å–æ–≤ (C++17)
std::mutex mtx1, mtx2;
{
    std::scoped_lock lock(mtx1, mtx2);  // –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ–±–∞ –±–µ–∑ deadlock
    // —Ä–∞–±–æ—Ç–∞ —Å —Ä–µ—Å—É—Ä—Å–∞–º–∏, –∑–∞—â–∏—â–µ–Ω–Ω—ã–º–∏ –æ–±–æ–∏–º–∏ –º—å—é—Ç–µ–∫—Å–∞–º–∏
}
```
- **`std::lock_guard`:** –ø—Ä–æ—Å—Ç–∞—è RAII –æ–±—ë—Ä—Ç–∫–∞
- **`std::unique_lock`:** –≥–∏–±–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (defer, try, timeout)
- **`std::scoped_lock` (C++17):** –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö mutex'–æ–≤
- **`std::shared_lock` (C++14):** –¥–ª—è readers-writers

### **–£—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (conditional variable)**

**std::condition_variable** ‚Äì –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏—è. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ—Ç–æ–∫—É –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–æ –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è –∏ –±—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–Ω—ã–º –¥—Ä—É–≥–∏–º –ø–æ—Ç–æ–∫–æ–º.

**–ú–µ—Ç–æ–¥—ã condition_variable:**
- `wait(lock)` - –∂–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `wait(lock, predicate)` - –∂–¥–∞—Ç—å –ø–æ–∫–∞ –ø—Ä–µ–¥–∏–∫–∞—Ç –Ω–µ —Å—Ç–∞–Ω–µ—Ç true
- `wait_for(lock, duration)` - –∂–¥–∞—Ç—å —Å —Ç–∞–π–º–∞—É—Ç–æ–º
- `notify_one()` - —É–≤–µ–¥–æ–º–∏—Ç—å –æ–¥–∏–Ω –ø–æ—Ç–æ–∫
- `notify_all()` - —É–≤–µ–¥–æ–º–∏—Ç—å –≤—Å–µ –ø–æ—Ç–æ–∫–∏

–£—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –º—å—é—Ç–µ–∫—Å–æ–º, –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω—ã —Å –∫–∞–∫–∏–º-–ª–∏–±–æ —É—Å–ª–æ–≤–∏–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ –Ω–∏–∂–µ —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –æ—á–µ—Ä–µ–¥—å –Ω–µ –ø—É—Å—Ç–∞). 
–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ–∂–∏–¥–∞–Ω–∏–µ -- –º–Ω–æ–≥–æ —Ä–∞–∑ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –º—å—é—Ç–µ–∫—Å (–Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å unique_lock). –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
1. –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –º—å—é—Ç–µ–∫—Å
2. –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —É—Å–ª–æ–≤–∏–µ
3. –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–æ—Å—å, —Ç–æ –º—å—é—Ç–µ–∫—Å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è, –ø–æ—Ç–æ–∫ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ –æ–∂–∏–¥–∞–Ω–∏–µ
4. –ø—Ä–∏—Ö–æ–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -- –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –ø–æ—Ç–æ–∫, –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –º—å—é—Ç–µ–∫—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏–µ
–∏ –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–æ—Å—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ 3
–ó–∞–º–µ—á–∞–Ω–∏–µ, –ø—Ä–æ —Å–ø–æ–Ω—Ç–∞–Ω–Ω—ã–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è (–û–° –±—É–¥–∏—Ç –ø–æ—Ç–æ–∫) –∏ –ø—Ä–æ–≤–µ—Ä–∫—É —É—Å–ª–æ–≤–∏—è –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤, —Ç.–∫. –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è –º–æ–∂–µ—Ç –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è.

```cpp
#include <condition_variable>
#include <mutex>
#include <queue>
#include <thread>

template<typename T>
class ThreadSafeQueue {
    std::queue<T> queue_;
    std::mutex mutex_;
    std::condition_variable condition_;
    
public:
    void push(T item) {
        std::lock_guard<std::mutex> lock(mutex_);
        queue_.push(item);
        condition_.notify_one();  // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ–¥–∏–Ω –∂–¥—É—â–∏–π –ø–æ—Ç–æ–∫
    }
    
    T pop() {
        std::unique_lock<std::mutex> lock(mutex_);
        
        // –ñ–¥–µ–º, –ø–æ–∫–∞ –æ—á–µ—Ä–µ–¥—å –Ω–µ —Å—Ç–∞–Ω–µ—Ç –Ω–µ–ø—É—Å—Ç–æ–π
        condition_.wait(lock, [this] { return !queue_.empty(); });
        
        T result = queue_.front();
        queue_.pop();
        return result;
    }
    
    bool empty() const {
        std::lock_guard<std::mutex> lock(mutex_);
        return queue_.empty();
    }
};

```

### **–°–µ–º–∞—Ñ–æ—Ä**

**std::counting_semaphore** (–°++20) ‚Äì –æ–±–æ–±—â–µ–Ω–∏–µ –º—å—é—Ç–µ–∫—Å–∞, –ø–æ–∑–≤–æ–ª—è—é—â–µ–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ä–µ—Å—É—Ä—Å–æ–≤.

```cpp
#include <semaphore>
#include <thread>
#include <vector>
#include <iostream>

// –°–µ–º–∞—Ñ–æ—Ä –Ω–∞ 3 —Ä–µ—Å—É—Ä—Å–∞
std::counting_semaphore<3> resource_semaphore(3);

void use_resource(int worker_id) {
    // –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Ä–µ—Å—É—Ä—Å (—É–º–µ–Ω—å—à–∞–µ–º —Å—á–µ—Ç—á–∏–∫)
    resource_semaphore.acquire();
    
    std::cout << "Worker " << worker_id << " got resource" << std::endl;
    
    // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ—Å—É—Ä—Å–æ–º
    std::this_thread::sleep_for(std::chrono::seconds(2));
    
    std::cout << "Worker " << worker_id << " releasing resource" << std::endl;
    
    // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å (—É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫)
    resource_semaphore.release();
}

int main() {
    std::vector<std::thread> workers;
    
    // –°–æ–∑–¥–∞–µ–º 10 —Ä–∞–±–æ—á–∏—Ö –ø–æ—Ç–æ–∫–æ–≤, –Ω–æ —Ç–æ–ª—å–∫–æ 3 —Å–º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
    for (int i = 0; i < 10; ++i) {
        workers.emplace_back(use_resource, i);
    }
    
    for (auto& worker : workers) {
        worker.join();
    }
    
    return 0;
}
```

**–¢–∏–ø—ã —Å–µ–º–∞—Ñ–æ—Ä–æ–≤:**
- `std::binary_semaphore` - —Å–µ–º–∞—Ñ–æ—Ä —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º 0 –∏–ª–∏ 1 (–∞–Ω–∞–ª–æ–≥ –º—å—é—Ç–µ–∫—Å–∞)
- `std::counting_semaphore<N>` - —Å–µ–º–∞—Ñ–æ—Ä —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º N

### **–ë–∞—Ä—å–µ—Ä—ã**

std::latch –∏ std::barrier (C++20)

**std::latch** - –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –±–∞—Ä—å–µ—Ä, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –ø–æ—Ç–æ–∫–∞–º –∂–¥–∞—Ç—å –ø–æ–∫–∞ —Å—á–µ—Ç—á–∏–∫ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç –Ω—É–ª—è.

```cpp
#include <latch>
#include <thread>
#include <vector>

void worker_with_latch(std::latch& done_latch, int worker_id) {
    // –í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞–±–æ—Ç—É
    std::cout << "Worker " << worker_id << " working..." << std::endl;
    std::this_thread::sleep_for(std::chrono::seconds(1 + worker_id % 3));
    
    std::cout << "Worker " << worker_id << " done" << std::endl;
    
    // –°–æ–æ–±—â–∞–µ–º –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    done_latch.count_down();
}

int main() {
    const int num_workers = 5;
    std::latch all_done(num_workers);  // –°—á–µ—Ç—á–∏–∫ –Ω–∞ 5
    
    std::vector<std::thread> workers;
    for (int i = 0; i < num_workers; ++i) {
        workers.emplace_back(worker_with_latch, std::ref(all_done), i);
    }
    
    // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤
    all_done.wait();
    std::cout << "All workers completed!" << std::endl;
    
    for (auto& worker : workers) {
        worker.join();
    }
    
    return 0;
}
```

**std::barrier** - –º–Ω–æ–≥–æ—Ä–∞–∑–æ–≤—ã–π –±–∞—Ä—å–µ—Ä –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–æ–≤ –ø–æ —Ñ–∞–∑–∞–º.

```cpp
#include <barrier>
#include <thread>

void phase_worker(std::barrier<>& sync_point, int worker_id) {
    for (int phase = 0; phase < 3; ++phase) {
        // –†–∞–±–æ—Ç–∞–µ–º –≤ —Ç–µ–∫—É—â–µ–π —Ñ–∞–∑–µ
        std::cout << "Worker " << worker_id << " phase " << phase << std::endl;
        std::this_thread::sleep_for(std::chrono::milliseconds(500 + worker_id * 100));
        
        // –ñ–¥–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
        sync_point.arrive_and_wait();
        
        std::cout << "Worker " << worker_id << " finished phase " << phase << std::endl;
    }
}

int main() {
    const int num_workers = 4;
    std::barrier sync_point(num_workers);
    
    std::vector<std::thread> workers;
    for (int i = 0; i < num_workers; ++i) {
        workers.emplace_back(phase_worker, std::ref(sync_point), i);
    }
    
    for (auto& worker : workers) {
        worker.join();
    }
    
    return 0;
}
```


---
#### **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å**
[[tasks-part-2]]


---


## üìã **2.3: –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ –≤ C++**

–í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –≤ C++ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å—é –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ—Ç–æ–∫–∞–º–∏. –≠—Ç–∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –ª–æ–≥–∏–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ –Ω–µ –Ω–∞ –¥–µ—Ç–∞–ª—è—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

### std::async –∏ std::future

**std::async**¬†- —ç—Ç–æ –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –∑–∞–¥–∞—á–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è—è —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–æ—Ç–æ–∫–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—è¬†**std::future**¬†–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

### ‚úÖ–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ std::async

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏**¬†- –Ω–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å std::thread –≤—Ä—É—á–Ω—É—é
2. **–ü—Ä–æ—Å—Ç–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**¬†- —á–µ—Ä–µ–∑ std::future
3. **–ì–∏–±–∫–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –∑–∞–ø—É—Å–∫–∞**¬†- sync/deferred/auto
4. **Exception-safe**¬†- –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ future

### –ü–æ–ª–∏—Ç–∏–∫–∏ –∑–∞–ø—É—Å–∫–∞ std::launch

```cpp
#include <future>
#include <iostream>

int expensive_computation(int n) {
    std::this_thread::sleep_for(std::chrono::seconds(1));
    return n * n;
}

int main() {
    // 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    auto future1 = std::async(expensive_computation, 5);
    
    // 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤ –Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ)
    auto future2 = std::async(std::launch::async, expensive_computation, 10);
    
    // 3. –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ get())
    auto future3 = std::async(std::launch::deferred, expensive_computation, 15);
    
    // 4. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞
    auto future4 = std::async(std::launch::async | std::launch::deferred, 
                             expensive_computation, 20);
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    std::cout << "Result 1: " << future1.get() << std::endl; // 25
    std::cout << "Result 2: " << future2.get() << std::endl; // 100
    std::cout << "Result 3: " << future3.get() << std::endl; // 225 (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–¥–µ—Å—å)
    std::cout << "Result 4: " << future4.get() << std::endl; // 400
    
    return 0;
}
```

### C—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –∑–∞–ø—É—Å–∫–∞

|**–ü–æ–ª–∏—Ç–∏–∫–∞**|**–ü–æ–≤–µ–¥–µ–Ω–∏–µ**|**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**|**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**|
|---|---|---|---|
|**std::launch::async**|–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫|–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –∏—Å—Ç–∏–Ω–Ω–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å|–í—ã—Å–æ–∫–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞|
|**std::launch::deferred**|–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø—Ä–∏ get()|–ö–æ–≥–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–µ—Ç –Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è|–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã|
|**auto (default)**|–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–∏—Ä–∞–µ—Ç|–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–ª—É—á–∞–µ–≤|–ë–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –≥–∏–±–∫–æ—Å—Ç—å|

### std::future - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**std::future**¬†–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏

```cpp
#include <future>
#include <vector>
#include <numeric>

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞
std::future<long long> async_sum(const std::vector<int>& data, 
                                size_t start, size_t end) {
    return std::async(std::launch::async, [&data, start, end]() {
        return std::accumulate(data.begin() + start, 
                              data.begin() + end, 0LL);
    });
}

int main() {
    std::vector<int> numbers(1000000);
    std::iota(numbers.begin(), numbers.end(), 1); // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ 1, 2, 3, ...
    
    const size_t num_threads = 4;
    const size_t chunk_size = numbers.size() / num_threads;
    
    std::vector<std::future<long long>> futures;
    
    // –°–æ–∑–¥–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
    for (size_t i = 0; i < num_threads; ++i) {
        size_t start = i * chunk_size;
        size_t end = (i == num_threads - 1) ? numbers.size() : (i + 1) * chunk_size;
        
        futures.push_back(async_sum(numbers, start, end));
    }
    
    // –°–æ–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    long long total_sum = 0;
    for (auto& future : futures) {
        total_sum += future.get(); // –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤
    }
    
    std::cout << "Total sum: " << total_sum << std::endl;
    
    return 0;
}

```

#### –ú–µ—Ç–æ–¥—ã std::future

```cpp
std::future<int> future = std::async(std::launch::async, []() {
    std::this_thread::sleep_for(std::chrono::seconds(2));
    return 42;
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
if (future.wait_for(std::chrono::seconds(0)) == std::future_status::ready) {
    std::cout << "Result is ready!" << std::endl;
} else {
    std::cout << "Still computing..." << std::endl;
}

// –û–∂–∏–¥–∞–Ω–∏–µ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
auto status = future.wait_for(std::chrono::seconds(1));
switch (status) {
    case std::future_status::ready:
        std::cout << "Ready: " << future.get() << std::endl;
        break;
    case std::future_status::timeout:
        std::cout << "Timeout occurred" << std::endl;
        break;
    case std::future_status::deferred:
        std::cout << "Task is deferred" << std::endl;
        break;
}
```
### std::promise - —Ä—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π

**std::promise**¬†–ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Ä—É—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω–æ —á–µ—Ä–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π std::future:

```cpp
#include <future>
#include <thread>

void producer(std::promise<std::string> promise) {
    // –ò–º–∏—Ç–∞—Ü–∏—è —Å–ª–æ–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã
    std::this_thread::sleep_for(std::chrono::seconds(2));
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    promise.set_value("Hello from producer!");
}

void consumer() {
    std::promise<std::string> promise;
    std::future<std::string> future = promise.get_future();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è
    std::thread producer_thread(producer, std::move(promise));
    
    // –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –¥—Ä—É–≥—É—é —Ä–∞–±–æ—Ç—É
    std::cout << "Consumer waiting for result..." << std::endl;
    
    // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏)
    std::string result = future.get();
    std::cout << "Received: " << result << std::endl;
    
    producer_thread.join();
}

```
### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π —Å std::promise/std::future

```cpp
void risky_producer(std::promise<int> promise) {
    try {
        // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
        std::this_thread::sleep_for(std::chrono::seconds(1));
        
        if (rand() % 2 == 0) {
            throw std::runtime_error("Something went wrong!");
        }
        
        promise.set_value(42);
    } catch (...) {
        // –ü–µ—Ä–µ–¥–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ promise
        promise.set_exception(std::current_exception());
    }
}

int main() {
    std::promise<int> promise;
    std::future<int> future = promise.get_future();
    
    std::thread t(risky_producer, std::move(promise));
    
    try {
        int result = future.get(); // –ú–æ–∂–µ—Ç –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
        std::cout << "Success: " << result << std::endl;
    } catch (const std::exception& e) {
        std::cout << "Exception caught: " << e.what() << std::endl;
    }
    
    t.join();
    return 0;
}

```

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –ø—É–ª –∑–∞–¥–∞—á —Å std::async

```cpp
#include <future>
#include <vector>
#include <functional>

class TaskPool {
    std::vector<std::future<void>> futures_;
    
public:
    template<typename Func, typename... Args>
    auto submit(Func&& func, Args&&... args) 
        -> std::future<std::invoke_result_t<Func, Args...>> {
        
        using return_type = std::invoke_result_t<Func, Args...>;
        
        auto task = std::make_shared<std::packaged_task<return_type()>>(
            std::bind(std::forward<Func>(func), std::forward<Args>(args)...)
        );
        
        std::future<return_type> result = task->get_future();
        
        futures_.push_back(
            std::async(std::launch::async, [task]() { (*task)(); })
        );
        
        return result;
    }
    
    void wait_all() {
        for (auto& future : futures_) {
            future.wait();
        }
        futures_.clear();
    }
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
int main() {
    TaskPool pool;
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏
    auto result1 = pool.submit([](int x) { return x * x; }, 5);
    auto result2 = pool.submit([](int a, int b) { return a + b; }, 10, 20);
    auto result3 = pool.submit([]() { 
        std::this_thread::sleep_for(std::chrono::seconds(1));
        return "Task completed";
    });
    
    // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    std::cout << "Result 1: " << result1.get() << std::endl; // 25
    std::cout << "Result 2: " << result2.get() << std::endl; // 30
    std::cout << "Result 3: " << result3.get() << std::endl; // "Task completed"
    
    pool.wait_all();
    
    return 0;
}
```

#### **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å**
[[tasks-part-2]]

---

## üìö –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ —Ä–µ—Å—É—Ä—Å—ã

1. **Anthony Williams** - "C++ Concurrency in Action" (2nd Edition)
2. **cppreference.com** - threading –∏ atomic –±–∏–±–ª–∏–æ—Ç–µ–∫–∏




---
